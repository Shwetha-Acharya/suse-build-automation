name: OpenSuse Build 

on: [workflow_dispatch]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
     - shell: bash
       env:
          USER: ${{ secrets.SUSE_USER }}
          PASSWORD: ${{ secrets.SUSE_PASSWORD }}
       run: |
          echo "$USER"
     - uses: actions/checkout@v2
     - name: Install Dependencies
       run: |
            sudo apt-get -y install osc
            mkdir -p ~/.config/osc/
            echo "[general]">>~/.config/osc/oscrc
            cat <<EOT >> ~/.config/osc/oscrc
            user=glusterfs
            credentials_mgr_class=osc.credentials.TransientCredentialsManager
            pass=env.PASSWORD
            EOT
            cat ~/.config/osc/oscrc
     - name: clone-gluster-suse
       run: |
          git config --global user.email "gluster-devel@gluster.org"
          git config --global user.name "Gluster"
          chmod +x clone-gluster-suse.sh
          ./clone-gluster-suse.sh tumbleweed 7 7.3
     - name: clone-gluster-suse
       run: |
          chmod +x trigger-build.sh
          ./trigger-build.sh tumbleweed 7.3
    

